<div class="container-fluid py-4">
  <!-- Header Section -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card shadow-sm border-0 bg-gradient-primary">
        <div class="card-body p-5 text-white">
          <div class="row align-items-center">
            <div class="col-md-8">
              <h1 class="display-5 fw-bold mb-3 text-light">
                <i class="ti ti-chart-bar me-3"></i>Event Statistics Dashboard
              </h1>
              <p class="lead mb-0">
                Comprehensive analytics and insights for your event management
                system
              </p>
            </div>
            <div class="col-md-4 text-md-end">
              <div
                class="bg-white bg-opacity-25 rounded-pill p-3 d-inline-block"
              >
                <i class="ti ti-dashboard fs-1"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation Tabs -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card shadow-sm border-0">
        <div class="card-body p-3">
          <ul class="nav nav-pills nav-fill">
            <li class="nav-item">
              <button
                class="nav-link"
                [class.active]="activeTab === 'overview'"
                (click)="setActiveTab('overview')"
              >
                <i class="ti ti-home me-2"></i>Overview
              </button>
            </li>
            <li class="nav-item">
              <button
                class="nav-link"
                [class.active]="activeTab === 'financial'"
                (click)="setActiveTab('financial')"
              >
                <i class="ti ti-currency-dollar me-2"></i>Financial
              </button>
            </li>
            <li class="nav-item">
              <button
                class="nav-link"
                [class.active]="activeTab === 'event'"
                (click)="setActiveTab('event')"
              >
                <i class="ti ti-calendar-event me-2"></i>Event Details
              </button>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Error Message -->
  <div class="row mb-4" *ngIf="errorMessage">
    <div class="col-12">
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="ti ti-alert-triangle me-2"></i>
        {{ errorMessage }}
        <button
          type="button"
          class="btn-close"
          (click)="errorMessage = ''"
        ></button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="row" *ngIf="isLoading">
    <div class="col-12">
      <div class="card shadow-sm border-0">
        <div class="card-body text-center py-5">
          <div
            class="spinner-border text-primary"
            style="width: 3rem; height: 3rem"
            role="status"
          >
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-3 text-muted fs-5">Loading statistics...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Overview Tab -->
  <div *ngIf="!isLoading && activeTab === 'overview'">
    <!-- Summary Cards -->
    <div class="row mb-4">
      <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-primary shadow-sm border-0 h-100 py-2">
          <div class="card-body">
            <div class="row no-gutters align-items-center">
              <div class="col mr-2">
                <div class="text-xs fw-bold text-primary text-uppercase mb-1">
                  Total Events
                </div>
                <div class="h5 mb-0 fw-bold text-gray-800">
                  {{ formatNumber(overallStats.totalEvents || 0) }}
                </div>
              </div>
              <div class="col-auto">
                <i class="ti ti-calendar-event fs-1 text-gray-300"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-success shadow-sm border-0 h-100 py-2">
          <div class="card-body">
            <div class="row no-gutters align-items-center">
              <div class="col mr-2">
                <div class="text-xs fw-bold text-success text-uppercase mb-1">
                  Upcoming Events
                </div>
                <div class="h5 mb-0 fw-bold text-gray-800">
                  {{ formatNumber(overallStats.upcomingEvents || 0) }}
                </div>
              </div>
              <div class="col-auto">
                <i class="ti ti-clock fs-1 text-gray-300"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-info shadow-sm border-0 h-100 py-2">
          <div class="card-body">
            <div class="row no-gutters align-items-center">
              <div class="col mr-2">
                <div class="text-xs fw-bold text-info text-uppercase mb-1">
                  Total Reservations
                </div>
                <div class="h5 mb-0 fw-bold text-gray-800">
                  {{ formatNumber(overallStats.totalReservations || 0) }}
                </div>
              </div>
              <div class="col-auto">
                <i class="ti ti-ticket fs-1 text-gray-300"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-warning shadow-sm border-0 h-100 py-2">
          <div class="card-body">
            <div class="row no-gutters align-items-center">
              <div class="col mr-2">
                <div class="text-xs fw-bold text-warning text-uppercase mb-1">
                  Total Revenue
                </div>
                <div class="h5 mb-0 fw-bold text-gray-800">
                  {{ formatCurrency(financialStats.totalRevenue || 0) }}
                </div>
              </div>
              <div class="col-auto">
                <i class="ti ti-currency-dollar fs-1 text-gray-300"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Row -->
    <div class="row">
      <!-- Events by Category Chart -->
      <div class="col-xl-6 col-lg-6 mb-4">
        <div class="card shadow-sm border-0 h-100">
          <div class="card-body chart-container">
            <canvas
              baseChart
              [data]="categoryChartConfig.data"
              [options]="categoryChartConfig.options"
              [type]="categoryChartConfig.type"
            >
            </canvas>
          </div>
        </div>
      </div>

      <!-- Events by Month Chart -->
      <div class="col-xl-6 col-lg-6 mb-4">
        <div class="card shadow-sm border-0 h-100">
          <div class="card-body chart-container">
            <canvas
              baseChart
              [data]="monthChartConfig.data"
              [options]="monthChartConfig.options"
              [type]="monthChartConfig.type"
            >
            </canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Financial Tab -->
  <div *ngIf="!isLoading && activeTab === 'financial'">
    <!-- Financial Summary Cards -->
    <div class="row mb-4">
      <div class="col-xl-4 col-md-6 mb-4">
        <div class="card border-left-primary shadow-sm border-0 h-100 py-2">
          <div class="card-body">
            <div class="row no-gutters align-items-center">
              <div class="col mr-2">
                <div class="text-xs fw-bold text-primary text-uppercase mb-1">
                  Total Revenue
                </div>
                <div class="h5 mb-0 fw-bold text-gray-800">
                  {{ formatCurrency(financialStats.totalRevenue || 0) }}
                </div>
              </div>
              <div class="col-auto">
                <i class="ti ti-currency-dollar fs-1 text-gray-300"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-4 col-md-6 mb-4">
        <div class="card border-left-success shadow-sm border-0 h-100 py-2">
          <div class="card-body">
            <div class="row no-gutters align-items-center">
              <div class="col mr-2">
                <div class="text-xs fw-bold text-success text-uppercase mb-1">
                  Total Transactions
                </div>
                <div class="h5 mb-0 fw-bold text-gray-800">
                  {{ formatNumber(financialStats.totalTransactions || 0) }}
                </div>
              </div>
              <div class="col-auto">
                <i class="ti ti-receipt fs-1 text-gray-300"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-4 col-md-6 mb-4">
        <div class="card border-left-info shadow-sm border-0 h-100 py-2">
          <div class="card-body">
            <div class="row no-gutters align-items-center">
              <div class="col mr-2">
                <div class="text-xs fw-bold text-info text-uppercase mb-1">
                  Average Transaction
                </div>
                <div class="h5 mb-0 fw-bold text-gray-800">
                  {{
                    financialStats.totalRevenue &&
                    financialStats.totalTransactions
                      ? formatCurrency(
                          financialStats.totalRevenue /
                            financialStats.totalTransactions
                        )
                      : formatCurrency(0)
                  }}
                </div>
              </div>
              <div class="col-auto">
                <i class="ti ti-calculator fs-1 text-gray-300"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Revenue Chart -->
    <div class="row">
      <div class="col-12 mb-4">
        <div class="card shadow-sm border-0">
          <div class="card-body chart-container">
            <canvas
              baseChart
              [data]="revenueChartConfig.data"
              [options]="revenueChartConfig.options"
              [type]="revenueChartConfig.type"
              style="height: 400px"
            >
            </canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Event Details Tab -->
  <div *ngIf="!isLoading && activeTab === 'event'">
    <!-- Event Selection -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow-sm border-0">
          <div class="card-body">
            <h6 class="fw-semibold mb-3">
              Select Event for Detailed Statistics
            </h6>
            <div class="row g-3 align-items-end">
              <div class="col-md-6">
                <label class="form-label fw-semibold">Event ID</label>
                <input
                  type="number"
                  class="form-control"
                  [(ngModel)]="selectedEventId"
                  placeholder="Enter event ID"
                />
              </div>
              <div class="col-md-6">
                <button
                  class="btn btn-primary"
                  (click)="loadEventStatistics()"
                  [disabled]="!selectedEventId"
                >
                  <i class="ti ti-chart-bar me-2"></i>Load Statistics
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Event Statistics Cards -->
    <div *ngIf="eventStats.event">
      <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-primary shadow-sm border-0 h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div class="text-xs fw-bold text-primary text-uppercase mb-1">
                    Total Reservations
                  </div>
                  <div class="h5 mb-0 fw-bold text-gray-800">
                    {{ formatNumber(eventStats.totalReservations || 0) }}
                  </div>
                </div>
                <div class="col-auto">
                  <i class="ti ti-ticket fs-1 text-gray-300"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-success shadow-sm border-0 h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div class="text-xs fw-bold text-success text-uppercase mb-1">
                    Confirmed
                  </div>
                  <div class="h5 mb-0 fw-bold text-gray-800">
                    {{ formatNumber(eventStats.confirmedReservations || 0) }}
                  </div>
                </div>
                <div class="col-auto">
                  <i class="ti ti-check fs-1 text-gray-300"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-info shadow-sm border-0 h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div class="text-xs fw-bold text-info text-uppercase mb-1">
                    Waitlist
                  </div>
                  <div class="h5 mb-0 fw-bold text-gray-800">
                    {{ formatNumber(eventStats.waitlistReservations || 0) }}
                  </div>
                </div>
                <div class="col-auto">
                  <i class="ti ti-clock fs-1 text-gray-300"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-warning shadow-sm border-0 h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div class="text-xs fw-bold text-warning text-uppercase mb-1">
                    Attendance Rate
                  </div>
                  <div class="h5 mb-0 fw-bold text-gray-800">
                    {{ formatPercentage(eventStats.attendanceRate || 0) }}
                  </div>
                </div>
                <div class="col-auto">
                  <i class="ti ti-users fs-1 text-gray-300"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Feedback Section -->
      <div class="row mb-4">
        <div class="col-md-6 mb-4">
          <div class="card shadow-sm border-0 h-100">
            <div class="card-body">
              <h6 class="fw-semibold mb-4">Feedback Statistics</h6>

              <div class="d-flex align-items-center mb-4">
                <div class="me-4 text-center">
                  <div class="h2 fw-bold text-primary mb-0">
                    {{ eventStats.averageRating?.toFixed(1) || "0.0" }}
                  </div>
                  <small class="text-muted">Average Rating</small>
                </div>
                <div>
                  <div class="rating-stars mb-2">
                    <span
                      *ngFor="
                        let star of getRatingStars(
                          eventStats.averageRating || 0
                        )
                      "
                      class="star active"
                    >
                      <i class="ti ti-star fs-4 text-warning"></i>
                    </span>
                    <span
                      *ngFor="
                        let star of getEmptyRatingStars(
                          eventStats.averageRating || 0
                        )
                      "
                      class="star"
                    >
                      <i class="ti ti-star fs-4 text-muted"></i>
                    </span>
                  </div>
                  <small class="text-muted"
                    >Based on {{ eventStats.feedbackCount || 0 }} reviews</small
                  >
                </div>
              </div>
              <div class="chart-container">
                <canvas
                  baseChart
                  [data]="feedbackChartConfig.data"
                  [options]="feedbackChartConfig.options"
                  [type]="feedbackChartConfig.type"
                  style="height: 250px"
                >
                </canvas>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6 mb-4">
          <div class="card shadow-sm border-0 h-100">
            <div class="card-body">
              <h6 class="fw-semibold mb-4">Event Information</h6>

              <div *ngIf="eventStats.event">
                <h5 class="fw-bold text-primary mb-3">
                  {{ eventStats.event.title }}
                </h5>

                <div class="d-flex align-items-center mb-3">
                  <i class="ti ti-calendar text-muted me-2"></i>
                  <span>{{
                    eventStats.event.startDateTime | date : "mediumDate"
                  }}</span>
                </div>

                <div class="d-flex align-items-center mb-3">
                  <i class="ti ti-clock text-muted me-2"></i>
                  <span
                    >{{ eventStats.event.startDateTime | date : "shortTime" }} -
                    {{
                      eventStats.event.endDateTime | date : "shortTime"
                    }}</span
                  >
                </div>

                <div class="d-flex align-items-center mb-3">
                  <i class="ti ti-map-pin text-muted me-2"></i>
                  <span>{{ eventStats.event.location }}</span>
                </div>

                <div class="d-flex align-items-center mb-3">
                  <i class="ti ti-users text-muted me-2"></i>
                  <span
                    >Capacity: {{ eventStats.event.capacity }} ({{
                      eventStats.event.availableSeats
                    }}
                    available)</span
                  >
                </div>

                <div class="d-flex align-items-center mb-3">
                  <i class="ti ti-currency-dollar text-muted me-2"></i>
                  <span
                    >Price:
                    {{ formatCurrency(eventStats.event.price || 0) }}</span
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- No Event Selected Message -->
    <div *ngIf="!eventStats.event" class="row">
      <div class="col-12">
        <div class="card shadow-sm border-0">
          <div class="card-body text-center py-5">
            <i class="ti ti-info-circle fs-1 text-muted d-block mb-3"></i>
            <h5 class="text-muted">Select an Event</h5>
            <p class="text-muted">
              Enter an event ID above to view detailed statistics
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
